<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™ìƒ ì„±ê³¼ ë¦¬í¬íŠ¸ ìƒì„±ê¸°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            body { 
                margin: 0; 
                padding: 20px;
                background: white !important;
                font-size: 12px;
            }
            .print-bg { 
                background: white !important; 
                box-shadow: none !important;
            }
            .text-4xl { font-size: 28px !important; }
            .text-3xl { font-size: 20px !important; }
            .text-xl { font-size: 16px !important; }
            .text-lg { font-size: 14px !important; }
            .mb-8 { margin-bottom: 20px !important; }
            .mb-6 { margin-bottom: 15px !important; }
            .p-6 { padding: 15px !important; }
            .gap-6 { gap: 10px !important; }
            .shadow-lg { box-shadow: none !important; }
            .rounded-lg { border-radius: 8px !important; border: 1px solid #e5e7eb; }
        }
        .star { color: #fbbf24; }
        .chart-container { position: relative; height: 300px; }
        @media print {
            .chart-container { height: 200px !important; }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app"></div>

    <script>
        // ì „ì—­ ìƒíƒœ
        let appState = {
            studentName: '',
            rawData: '',
            parsedData: [],
            showPreview: false,
            shareUrl: '',
            showShareUrl: false
        };

        // URLì—ì„œ ë¦¬í¬íŠ¸ ë°ì´í„° ì½ê¸° (ê°œì„ ëœ ë²„ì „)
        function loadFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const reportData = urlParams.get('report');
            const reportId = urlParams.get('id');
            
            try {
                let decodedData;
                
                if (reportId) {
                    // localStorageì—ì„œ ë°ì´í„° ì½ê¸°
                    const storedData = localStorage.getItem(reportId);
                    if (storedData) {
                        decodedData = JSON.parse(storedData);
                        console.log('localStorageì—ì„œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                    } else {
                        console.error('í•´ë‹¹ IDì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    }
                } else if (reportData) {
                    // URLì—ì„œ ì§ì ‘ ë°ì´í„° ì½ê¸°
                    decodedData = JSON.parse(atob(reportData));
                    console.log('URLì—ì„œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                } else {
                    return;
                }
                
                // ì••ì¶•ëœ ë°ì´í„°ì¸ì§€ í™•ì¸
                if (decodedData.n && decodedData.d) {
                    // ìƒˆë¡œìš´ ì••ì¶• í˜•ì‹
                    appState.studentName = decodedData.n;
                    appState.parsedData = decompressData(decodedData.d);
                } else {
                    // ê¸°ì¡´ í˜•ì‹ (í•˜ìœ„ í˜¸í™˜ì„±)
                    appState.studentName = decodedData.studentName;
                    appState.parsedData = decodedData.parsedData;
                }
                
                appState.showPreview = true;
            } catch (error) {
                console.error('URL ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
                alert('ë§í¬ê°€ ì†ìƒë˜ì—ˆê±°ë‚˜ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë…¸ì…˜ ë°ì´í„° íŒŒì‹±
        function parseNotionData(text) {
            const lines = text.trim().split('\n');
            const data = [];
            
            lines.forEach(line => {
                const parts = line.split(/\t+/).filter(part => part !== undefined);
                
                if (parts.length >= 2) {
                    const date = parts[0] ? parts[0].trim() : '';
                    const attendance = parts[1] ? parts[1].trim() : '';
                    const wordScore = parts[2] ? parts[2].trim() : '';
                    const totalWords = parts[3] ? parts[3].trim() : '';
                    const retest = parts[4] ? parts[4].trim() : '';
                    const homework = parts[5] ? parts[5].trim() : '';
                    const attitude = parts[6] ? parts[6].trim() : '';
                    
                    const convertStars = (stars) => {
                        if (!stars) return null;
                        const starCount = (stars.match(/â˜…/g) || []).length;
                        return starCount;
                    };

                    const isAbsent = attendance === 'ê²°ì„';

                    data.push({
                        date: date,
                        attendance: attendance,
                        wordScore: !isAbsent && wordScore && wordScore !== '' ? parseInt(wordScore) : null,
                        totalWords: !isAbsent && totalWords && totalWords !== '' ? parseInt(totalWords) : null,
                        retest: !isAbsent && retest && retest.includes('ì¬ì‹œí—˜') ? 'ì¬ì‹œí—˜' : '',
                        homework: !isAbsent ? convertStars(homework) : null,
                        attitude: !isAbsent ? convertStars(attitude) : null
                    });
                }
            });
            
            return data.reverse();
        }

        // í†µê³„ ê³„ì‚°
        function calculateStats(parsedData) {
            const totalClasses = parsedData.length;
            const attendanceCount = parsedData.filter(d => d.attendance === 'ì¶œì„').length;
            const lateCount = parsedData.filter(d => d.attendance === 'ì§€ê°').length;
            const absentCount = parsedData.filter(d => d.attendance === 'ê²°ì„').length;
            const attendanceRate = (((attendanceCount + lateCount) / totalClasses) * 100).toFixed(1);
            const retestCount = parsedData.filter(d => d.retest === 'ì¬ì‹œí—˜').length;

            const chartData = parsedData.map((item, index) => {
                const accuracy = item.wordScore !== null && item.totalWords !== null && item.totalWords > 0 
                    ? (item.wordScore / item.totalWords * 100) 
                    : null;
                
                return {
                    ...item,
                    day: index + 1,
                    accuracy: accuracy,
                    shortDate: item.date.substring(5)
                };
            }).filter(item => item.accuracy !== null && !isNaN(item.accuracy));

            const averageAccuracy = chartData.length > 0 ? chartData.reduce((sum, item) => sum + item.accuracy, 0) / chartData.length : 0;

            return {
                totalClasses,
                attendanceCount,
                lateCount,
                absentCount,
                attendanceRate,
                retestCount,
                averageAccuracy,
                chartData
            };
        }

        // ë°ì´í„° ì••ì¶• í•¨ìˆ˜
        function compressData(data) {
            // ë¶ˆí•„ìš”í•œ ë°ì´í„° ì œê±° ë° ì••ì¶•
            const compressed = data.map(item => ({
                d: item.date.substring(5), // MM/DDë§Œ ì €ì¥
                a: item.attendance === 'ì¶œì„' ? 1 : item.attendance === 'ì§€ê°' ? 2 : 3,
                w: item.wordScore,
                t: item.totalWords,
                r: item.retest === 'ì¬ì‹œí—˜' ? 1 : 0,
                h: item.homework,
                at: item.attitude
            }));
            return compressed;
        }

        // ë°ì´í„° ì••ì¶• í•´ì œ í•¨ìˆ˜
        function decompressData(compressed) {
            const currentYear = new Date().getFullYear();
            return compressed.map(item => ({
                date: `${currentYear}/${item.d}`,
                attendance: item.a === 1 ? 'ì¶œì„' : item.a === 2 ? 'ì§€ê°' : 'ê²°ì„',
                wordScore: item.w,
                totalWords: item.t,
                retest: item.r === 1 ? 'ì¬ì‹œí—˜' : '',
                homework: item.h,
                attitude: item.at
            }));
        }

        // ê³µìœ  ë§í¬ ìƒì„± (ê°œì„ ëœ ë²„ì „)
        function generateShareUrl() {
            try {
                const compressedData = compressData(appState.parsedData);
                const reportData = {
                    n: appState.studentName,
                    d: compressedData
                };
                
                const jsonString = JSON.stringify(reportData);
                console.log('ì••ì¶•ëœ ë°ì´í„° í¬ê¸°:', jsonString.length);
                
                // ë§¤ìš° ê³µê²©ì ì¸ ì••ì¶• ì‹œë„
                if (jsonString.length > 1200) {
                    // í•„ìˆ˜ ë°ì´í„°ë§Œ í¬í•¨í•˜ëŠ” ê·¹ë‹¨ì  ì••ì¶•
                    const minimalData = {
                        n: appState.studentName,
                        d: compressedData.slice(0, 10) // ìµœê·¼ 10ê°œ ë°ì´í„°ë§Œ
                    };
                    const minimalJson = JSON.stringify(minimalData);
                    
                    if (minimalJson.length > 1200) {
                        // ê·¸ë˜ë„ ë„ˆë¬´ í¬ë©´ URL ë³µì‚¬ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
                        showManualShareOption();
                        return;
                    }
                    
                    const encodedData = btoa(minimalJson);
                    const baseUrl = window.location.origin + window.location.pathname;
                    const newShareUrl = `${baseUrl}?report=${encodedData}`;
                    
                    appState.shareUrl = newShareUrl;
                    appState.showShareUrl = true;
                    render();
                    
                    alert('ë°ì´í„°ê°€ ì»¤ì„œ ìµœê·¼ 10ê°œ ìˆ˜ì—… ë°ì´í„°ë§Œ í¬í•¨ëœ ë§í¬ë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.');
                    return;
                }
                
                const encodedData = btoa(jsonString);
                const baseUrl = window.location.origin + window.location.pathname;
                const newShareUrl = `${baseUrl}?report=${encodedData}`;
                
                appState.shareUrl = newShareUrl;
                appState.showShareUrl = true;
                render();
                console.log('ë§í¬ ìƒì„± ì™„ë£Œ:', newShareUrl.length, 'ì');
                
            } catch (error) {
                console.error('ë§í¬ ìƒì„± ì˜¤ë¥˜:', error);
                showManualShareOption();
            }
        }

        // ìˆ˜ë™ ê³µìœ  ì˜µì…˜ í‘œì‹œ
        function showManualShareOption() {
            const manualUrl = window.location.origin + window.location.pathname;
            appState.shareUrl = `${manualUrl}

ğŸ“ ìˆ˜ë™ ê³µìœ  ë°©ë²•:
1. ì´ ë§í¬ë¥¼ í•™ë¶€ëª¨ë‹˜ê»˜ ë³´ë‚´ì£¼ì„¸ìš”: ${manualUrl}
2. ì•„ë˜ ë°ì´í„°ë¥¼ í•¨ê»˜ ì „ë‹¬í•´ì£¼ì„¸ìš”:

í•™ìƒëª…: ${appState.studentName}
ë°ì´í„°:
${appState.parsedData.map(item => 
    `${item.date}\t${item.attendance}\t${item.wordScore || ''}\t${item.totalWords || ''}\t${item.retest}\t${'â˜…'.repeat(item.homework || 0)}${'â˜†'.repeat(3-(item.homework || 0))}\t${'â˜…'.repeat(item.attitude || 0)}${'â˜†'.repeat(3-(item.attitude || 0))}`
).join('\n')}`;
            
            appState.showShareUrl = true;
            render();
        }

        // ë§í¬ ë³µì‚¬
        async function copyShareUrl() {
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(appState.shareUrl);
                    alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    const textArea = document.createElement('textarea');
                    textArea.value = appState.shareUrl;
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }
            } catch (error) {
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë§í¬ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”:\\n\\n' + appState.shareUrl);
            }
        }

        // ì°¨íŠ¸ ìƒì„±
        function createCharts(stats) {
            setTimeout(() => {
                // ì„ í˜• ì°¨íŠ¸
                const lineCtx = document.getElementById('lineChart');
                if (lineCtx && stats.chartData.length > 0) {
                    new Chart(lineCtx, {
                        type: 'line',
                        data: {
                            labels: stats.chartData.map(item => item.shortDate),
                            datasets: [{
                                label: 'ì •ë‹µë¥  (%)',
                                data: stats.chartData.map(item => item.accuracy),
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.3,
                                pointBackgroundColor: '#3b82f6',
                                pointRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100
                                }
                            }
                        }
                    });
                }

                // ì›í˜• ì°¨íŠ¸ë“¤
                const attendanceData = [
                    { label: 'ì¶œì„', value: stats.attendanceCount, color: '#10b981' },
                    { label: 'ì§€ê°', value: stats.lateCount, color: '#f59e0b' },
                    { label: 'ê²°ì„', value: stats.absentCount, color: '#ef4444' }
                ].filter(item => item.value > 0);

                const attendanceCtx = document.getElementById('attendanceChart');
                if (attendanceCtx && attendanceData.length > 0) {
                    new Chart(attendanceCtx, {
                        type: 'pie',
                        data: {
                            labels: attendanceData.map(item => item.label),
                            datasets: [{
                                data: attendanceData.map(item => item.value),
                                backgroundColor: attendanceData.map(item => item.color)
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }

                // ìˆ™ì œ ë¶„ì„
                const homeworkData = appState.parsedData.filter(d => d.homework !== null);
                const homework1 = homeworkData.filter(d => d.homework === 1).length;
                const homework2 = homeworkData.filter(d => d.homework === 2).length;
                const homework3 = homeworkData.filter(d => d.homework === 3).length;

                const homeworkPieData = [
                    { label: 'ë¯¸í¡ (â˜…â˜†â˜†)', value: homework1, color: '#ef4444' },
                    { label: 'ë³´í†µ (â˜…â˜…â˜†)', value: homework2, color: '#f59e0b' },
                    { label: 'ìš°ìˆ˜ (â˜…â˜…â˜…)', value: homework3, color: '#10b981' }
                ].filter(item => item.value > 0);

                const homeworkCtx = document.getElementById('homeworkChart');
                if (homeworkCtx && homeworkPieData.length > 0) {
                    new Chart(homeworkCtx, {
                        type: 'pie',
                        data: {
                            labels: homeworkPieData.map(item => item.label),
                            datasets: [{
                                data: homeworkPieData.map(item => item.value),
                                backgroundColor: homeworkPieData.map(item => item.color)
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }

                // ìˆ˜ì—… íƒœë„ ë¶„ì„
                const attitudeData = appState.parsedData.filter(d => d.attitude !== null);
                const attitude1 = attitudeData.filter(d => d.attitude === 1).length;
                const attitude2 = attitudeData.filter(d => d.attitude === 2).length;
                const attitude3 = attitudeData.filter(d => d.attitude === 3).length;

                const attitudePieData = [
                    { label: 'ë¯¸í¡ (â˜…â˜†â˜†)', value: attitude1, color: '#ef4444' },
                    { label: 'ë³´í†µ (â˜…â˜…â˜†)', value: attitude2, color: '#f59e0b' },
                    { label: 'ìš°ìˆ˜ (â˜…â˜…â˜…)', value: attitude3, color: '#10b981' }
                ].filter(item => item.value > 0);

                const attitudeCtx = document.getElementById('attitudeChart');
                if (attitudeCtx && attitudePieData.length > 0) {
                    new Chart(attitudeCtx, {
                        type: 'pie',
                        data: {
                            labels: attitudePieData.map(item => item.label),
                            datasets: [{
                                data: attitudePieData.map(item => item.value),
                                backgroundColor: attitudePieData.map(item => item.color)
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });
                }
            }, 100);
        }

        // ë Œë”ë§
        function render() {
            const app = document.getElementById('app');

            if (appState.showPreview) {
                const stats = calculateStats(appState.parsedData);
                const isExcellent = stats.averageAccuracy >= 85 && stats.retestCount <= 2 && stats.attendanceRate >= 95;
                const themeColor = isExcellent ? 'blue' : stats.averageAccuracy >= 70 ? 'orange' : 'red';

                app.innerHTML = `
                    <div class="no-print fixed top-4 right-4 z-50 space-y-2">
                        <div class="flex flex-wrap gap-2">
                            <button onclick="resetForm()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                                ğŸ”„ ìƒˆ ë¦¬í¬íŠ¸ ì‘ì„±
                            </button>
                            <button onclick="window.print()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors text-lg font-semibold">
                                ğŸ“„ PDFë¡œ ì €ì¥í•˜ê¸°
                            </button>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-sm">
                            <h3 class="font-semibold text-blue-800 mb-2">ğŸ“± í•™ë¶€ëª¨ë‹˜ê»˜ ì „ì†¡ ë°©ë²•</h3>
                            <div class="text-sm text-blue-700 space-y-1">
                                <p>1ï¸âƒ£ "PDFë¡œ ì €ì¥í•˜ê¸°" í´ë¦­</p>
                                <p>2ï¸âƒ£ ì €ì¥ëœ PDF íŒŒì¼ì„</p>
                                <p>3ï¸âƒ£ ì¹´í†¡/ì´ë©”ì¼ë¡œ ì „ì†¡</p>
                                <p class="font-medium mt-2">âœ¨ ê°„ë‹¨í•˜ê³  í™•ì‹¤í•´ìš”!</p>
                            </div>
                        </div>
                    </div>

                    <div class="min-h-screen bg-gradient-to-br from-${themeColor}-50 to-${themeColor}-100 p-6 print-bg">
                        <div class="max-w-7xl mx-auto">
                            <!-- í—¤ë” -->
                            <div class="text-center mb-8">
                                <h1 class="text-4xl font-bold text-gray-800 mb-2">í•™ê¸°ë§ ì„±ê³¼ ë¦¬í¬íŠ¸</h1>
                                <p class="text-xl text-gray-600">${appState.studentName} í•™ìƒ â€¢ 2025ë…„ 1í•™ê¸°</p>
                            </div>

                            <!-- ìš”ì•½ ì¹´ë“œë“¤ -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                                    <div class="text-${themeColor}-500 mb-3">ğŸ“…</div>
                                    <h3 class="text-lg font-semibold text-gray-700">ì¶œì„ë¥ </h3>
                                    <p class="text-3xl font-bold text-${themeColor}-600">${stats.attendanceRate}%</p>
                                    <p class="text-sm text-gray-500">${stats.attendanceCount + stats.lateCount}/${stats.totalClasses}ì¼</p>
                                    ${stats.lateCount > 0 ? `<p class="text-xs text-gray-400">ì§€ê° ${stats.lateCount}íšŒ</p>` : ''}
                                </div>

                                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                                    <div class="text-green-500 mb-3">ğŸ“ˆ</div>
                                    <h3 class="text-lg font-semibold text-gray-700">í‰ê·  ì •ë‹µë¥ </h3>
                                    <p class="text-3xl font-bold text-green-600">${stats.averageAccuracy.toFixed(1)}%</p>
                                    <p class="text-sm text-gray-500">ë‹¨ì–´ í…ŒìŠ¤íŠ¸</p>
                                </div>

                                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                                    <div class="${stats.retestCount > 5 ? 'text-red-500' : 'text-blue-500'} mb-3">${stats.retestCount > 5 ? 'âš ï¸' : 'ğŸ“š'}</div>
                                    <h3 class="text-lg font-semibold text-gray-700">ì¬ì‹œí—˜ íšŸìˆ˜</h3>
                                    <p class="text-3xl font-bold ${stats.retestCount > 5 ? 'text-red-600' : 'text-blue-600'}">${stats.retestCount}íšŒ</p>
                                    <p class="text-sm text-gray-500">${stats.retestCount > 5 ? 'ê°œì„  í•„ìš”' : 'ì–‘í˜¸'}</p>
                                </div>

                                <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                                    <div class="text-purple-500 mb-3">ğŸ†</div>
                                    <h3 class="text-lg font-semibold text-gray-700">ì¢…í•© í‰ê°€</h3>
                                    <div class="text-2xl font-bold text-purple-600">
                                        ${isExcellent ? 'ìš°ìˆ˜' : stats.averageAccuracy >= 70 ? 'ë³´í†µ' : 'ë…¸ë ¥'}
                                    </div>
                                    <p class="text-sm text-gray-500">
                                        ${isExcellent ? 'ë§¤ìš° ìš°ìˆ˜í•¨' : stats.averageAccuracy >= 70 ? 'ê¾¸ì¤€íˆ í–¥ìƒ ì¤‘' : 'ê°œì„  í•„ìš”'}
                                    </p>
                                </div>
                            </div>

                            <!-- ë‹¨ì–´ ì ìˆ˜ ì¶”ì´ ì°¨íŠ¸ -->
                            ${stats.chartData.length > 0 ? `
                            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                                <h3 class="text-xl font-semibold text-gray-800 mb-4">ë‹¨ì–´ í…ŒìŠ¤íŠ¸ ì •ë‹µë¥  ì¶”ì´</h3>
                                <div class="chart-container">
                                    <canvas id="lineChart"></canvas>
                                </div>
                            </div>
                            ` : ''}

                            <!-- ì›í˜• ê·¸ë˜í”„ ì„¹ì…˜ -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                                <div class="bg-white rounded-lg shadow-lg p-6">
                                    <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">ì¶œì„ í˜„í™©</h3>
                                    <div class="chart-container">
                                        <canvas id="attendanceChart"></canvas>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg shadow-lg p-6">
                                    <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">ìˆ˜ì—… íƒœë„</h3>
                                    <div class="chart-container">
                                        <canvas id="attitudeChart"></canvas>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg shadow-lg p-6">
                                    <h3 class="text-xl font-semibold text-gray-800 mb-4 text-center">ìˆ™ì œ ì´í–‰</h3>
                                    <div class="chart-container">
                                        <canvas id="homeworkChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- ì´í‰ -->
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-gray-800 mb-4">í•™ê¸° ì´í‰</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-semibold text-gray-700 mb-3 text-green-600">ê°•ì </h4>
                                        <div class="space-y-2 text-gray-700 text-sm">
                                            ${stats.attendanceRate >= 90 ? '<p class="flex items-center"><span class="inline-block w-2 h-2 bg-green-500 rounded-full mr-3"></span>ìš°ìˆ˜í•œ ì¶œì„ë¥  (' + stats.attendanceRate + '%)</p>' : ''}
                                            <p class="flex items-center"><span class="inline-block w-2 h-2 bg-green-500 rounded-full mr-3"></span>ê¾¸ì¤€í•œ ìˆ˜ì—… ì°¸ì—¬</p>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-gray-700 mb-3 text-red-600">ê°œì„  í•„ìš”ì‚¬í•­</h4>
                                        <div class="space-y-2 text-gray-700 text-sm">
                                            ${stats.retestCount > 3 ? '<p class="flex items-center"><span class="inline-block w-2 h-2 bg-red-500 rounded-full mr-3"></span>ì¬ì‹œí—˜ íšŸìˆ˜ ì¤„ì´ê¸° (' + stats.retestCount + 'íšŒ)</p>' : ''}
                                            ${stats.lateCount > 0 ? '<p class="flex items-center"><span class="inline-block w-2 h-2 bg-orange-500 rounded-full mr-3"></span>ì§€ê° íšŸìˆ˜ ì¤„ì´ê¸° (' + stats.lateCount + 'íšŒ)</p>' : ''}
                                            ${stats.averageAccuracy < 80 ? '<p class="flex items-center"><span class="inline-block w-2 h-2 bg-blue-500 rounded-full mr-3"></span>ì˜ˆìŠµÂ·ë³µìŠµì„ í†µí•œ í•™ìŠµ ë³´ì™„</p>' : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                createCharts(stats);
            } else {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-indigo-50 to-blue-100 p-6">
                        <div class="max-w-4xl mx-auto">
                            <div class="text-center mb-8">
                                <h1 class="text-4xl font-bold text-gray-800 mb-2">í•™ìƒ ì„±ê³¼ ë¦¬í¬íŠ¸ ìƒì„±ê¸°</h1>
                                <p class="text-xl text-gray-600">ë…¸ì…˜ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì—¬ ìë™ìœ¼ë¡œ ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”</p>
                            </div>

                            <div class="bg-white rounded-lg shadow-lg p-8">
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">í•™ìƒ ì´ë¦„</label>
                                        <input type="text" id="studentNameInput" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì˜ˆ: í™ê¸¸ë™">
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">ë…¸ì…˜ ë°ì´í„° (ë³µì‚¬-ë¶™ì—¬ë„£ê¸°)</label>
                                        <div class="mb-2 text-sm text-gray-500 bg-gray-50 p-3 rounded">
                                            <strong>ì‚¬ìš©ë²•:</strong> ë…¸ì…˜ì—ì„œ í‘œ ë°ì´í„°ë¥¼ ì„ íƒí•˜ì—¬ ë³µì‚¬í•œ í›„ ì•„ë˜ í…ìŠ¤íŠ¸ ë°•ìŠ¤ì— ë¶™ì—¬ë„£ê¸°í•˜ì„¸ìš”.<br/>
                                            <strong>í˜•ì‹:</strong> ë‚ ì§œ | ì¶œê²° | ë‹¨ì–´ì ìˆ˜ | ë‹¨ì–´ì´ê°œìˆ˜ | ì¬ì‹œí—˜ì—¬ë¶€ | ìˆ™ì œìƒíƒœ(â˜…) | ìˆ˜ì—…íƒœë„(â˜…)
                                        </div>
                                        <textarea id="rawDataInput" class="w-full h-64 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm" placeholder="ì˜ˆ:
2025/08/04	ì¶œì„	8	8		â˜…â˜…â˜…	â˜…â˜…â˜…
2025/08/01	ì¶œì„	19	25	ì¬ì‹œí—˜	â˜…â˜…â˜…	â˜…â˜…â˜…
2025/07/25	ì¶œì„	24	25		â˜…â˜…â˜…	â˜…â˜…â˜…"></textarea>
                                    </div>

                                    <div class="flex justify-center space-x-4">
                                        <button onclick="handleSubmit()" class="bg-blue-500 text-white px-8 py-3 rounded-lg hover:bg-blue-600 transition-colors flex items-center gap-2">
                                            ğŸ‘ï¸ ë¦¬í¬íŠ¸ ìƒì„±í•˜ê¸°
                                        </button>
                                    </div>
                                </div>

                                <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                                    <h3 class="font-semibold text-gray-700 mb-2">ìƒ˜í”Œ ë°ì´í„° (í…ŒìŠ¤íŠ¸ìš©)</h3>
                                    <button onclick="loadSampleData()" class="text-sm bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300 transition-colors">
                                        ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤
        function handleSubmit() {
            const studentName = document.getElementById('studentNameInput').value;
            const rawData = document.getElementById('rawDataInput').value;

            if (!studentName.trim()) {
                alert('í•™ìƒ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!rawData.trim()) {
                alert('ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const parsed = parseNotionData(rawData);
            if (parsed.length === 0) {
                alert('ë°ì´í„° í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            appState.studentName = studentName;
            appState.rawData = rawData;
            appState.parsedData = parsed;
            appState.showPreview = true;
            render();
        }

        function resetForm() {
            appState.studentName = '';
            appState.rawData = '';
            appState.parsedData = [];
            appState.showPreview = false;
            appState.shareUrl = '';
            appState.showShareUrl = false;
            window.history.pushState({}, document.title, window.location.pathname);
            render();
        }

        function loadSampleData() {
            document.getElementById('studentNameInput').value = 'í™ê¸¸ë™';
            document.getElementById('rawDataInput').value = `2025/08/04	ì¶œì„	8	8		â˜…â˜…â˜…	â˜…â˜…â˜…
2025/08/01	ì¶œì„	19	25	ì¬ì‹œí—˜	â˜…â˜…â˜…	â˜…â˜…â˜…
2025/07/25	ì¶œì„	24	25		â˜…â˜…â˜…	â˜…â˜…â˜…
2025/07/23	ì¶œì„	6	7		â˜…â˜…â˜…	â˜…â˜…â˜…
2025/07/21	ì¶œì„	8	8		â˜…â˜…â˜…	â˜…â˜…â˜…
2025/07/18	ê²°ì„					
2025/07/16	ì¶œì„	7	7		â˜…â˜…â˜…	â˜…â˜…â˜…`;
        }

        // ì´ˆê¸°í™”
        window.onload = function() {
            loadFromURL();
            render();
        };
    </script>
</body>
</html>
